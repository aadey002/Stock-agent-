# Stock Agent 4 - Q5D Daily Analysis
# Fixed: Runs fetch_data.py to get latest market data

name: Q5D Daily Analysis

on:
  schedule:
    - cron: '35 14 * * 1-5'  # 9:35 AM ET
    - cron: '05 21 * * 1-5'  # 4:05 PM ET
    - cron: '00 23 * * 1-5'  # 6:00 PM ET
  workflow_dispatch:

permissions:
  contents: write

jobs:
  analyze:
    runs-on: ubuntu-latest
    env:
      TZ: America/New_York
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
        with:
          ref: main

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ“¦ Install deps
        run: pip install pandas numpy requests --quiet

      - name: ğŸ“‚ Create folders
        run: mkdir -p data reports logs

      - name: ğŸ“¥ Fetch Data
        env:
          TIINGO_TOKEN: ${{ secrets.TIINGO_TOKEN }}
        run: python fetch_data.py

      - name: ğŸ¤– Run Base Agent
        env:
          TIINGO_TOKEN: ${{ secrets.TIINGO_TOKEN }}
        continue-on-error: true
        run: python agents/base_agent.py || echo