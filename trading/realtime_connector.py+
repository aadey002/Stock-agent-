#!/usr/bin/env python3
"""Real-Time Connector - Tiingo API Integration"""

import requests
import logging
from datetime import datetime

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("realtime_connector")

api_key = "YOUR_ACTUAL_API_KEY_HERE"

class RealtimeConnector:
    """Connects to Tiingo API for live prices."""
    
    def __init__(self, api_key: str):
        """Initialize with API key."""
        self.api_key = api_key
        self.base_url = "https://api.tiingo.com/iex"
        self.last_price = None
        self.last_update = None
        logger.info(f"RealtimeConnector initialized")
    
    def get_latest_price(self, ticker: str = "SPY") -> dict:
        """Get latest price for ticker."""
        try:
            url = f"{self.base_url}/?tickers={ticker}&token={self.api_key}"
            response = requests.get(url, timeout=5)
            
            if response.status_code == 200:
                data = response.json()[0]
                price = data.get('last', 0)
                timestamp = data.get('timestamp', '')
                
                self.last_price = price
                self.last_update = timestamp
                
                logger.info(f"? Price:  @ {timestamp}")
                return {'price': price, 'timestamp': timestamp, 'connected': True}
            else:
                logger.error(f"API error: {response.status_code}")
                return {'price': 0, 'timestamp': '', 'connected': False}
        except Exception as e:
            logger.error(f"Connection error: {e}")
            return {'price': 0, 'timestamp': '', 'connected': False}
    
    def get_status(self) -> dict:
        """Get connection status."""
        return {
            'last_price': self.last_price,
            'last_update': self.last_update,
            'connected': self.last_price is not None
        }

if __name__ == "__main__":
    logger.info("=" * 60)
    logger.info("REALTIME CONNECTOR - TEST")
    logger.info("=" * 60)
    
    connector = RealtimeConnector(api_key)
    
    for i in range(5):
        connector.get_latest_price("SPY")
    
    status = connector.get_status()
    logger.info(f"Status: {status}")
    logger.info("=" * 60)
